<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ATSPro â€“ ATS Resume Checker</title>
  <link rel="stylesheet" href="style.css">
  <script src="nav.js" defer></script>
</head>
<body>

  <div class="panel">
    <h1>ATSPro Resume Checker</h1>
    <p style="text-align:center;color:#d1d5db;margin-top:-4px;">
      Upload your resume and job description to get an ATS-style score.
    </p>

    <!-- TRUST STRIP -->
    <div class="trust-strip">
      <div class="trust-item">ðŸ”’ We donâ€™t store your resume</div>
      <div class="trust-item">ðŸ§  Real ATS parsing + AI improvements</div>
      <div class="trust-item">âœ… No login â€¢ 100% free</div>
    </div>

    <!-- ATS SCORE FORM -->
    <form id="resumeForm">
      <label for="file">Resume (PDF or DOCX)</label>

      <div class="upload-row">
        <input type="file" id="file" accept=".pdf,.docx" required class="file-input-hidden">
        <button type="button" class="upload-btn" id="fileTrigger">ðŸ“„ Upload Resume</button>
        <span class="file-name" id="fileName">No file selected</span>
      </div>

      <label for="job_description">Job Description (optional but recommended)</label>
      <textarea id="job_description" placeholder="Paste the job description here..."></textarea>

      <button id="submitBtn" type="submit">Check ATS Score</button>
    </form>

    <!-- ATS RESULT -->
    <div id="result" class="result" style="display:none;"></div>

    <!-- AI RESUME ASSISTANT -->
    <div class="ai-panel" style="margin-top:32px;">
      <h2 style="color:#facc15;">AI Resume Assistant (Gemini)</h2>

      <!-- AI Summary Rewrite -->
      <div class="ai-block">
        <h3 style="color:#facc15;">Improve Summary with AI</h3>
        <textarea id="aiSummaryInput" placeholder="Paste your current resume summary..." rows="4"></textarea>
        <button id="aiSummaryBtn">âœ¨ Improve Summary</button>
        <textarea id="aiSummaryOutput" rows="4" readonly></textarea>
      </div>

      <!-- AI Bullet Rewrite -->
      <div class="ai-block">
        <h3 style="color:#facc15;">Rewrite Bullet with AI</h3>
        <textarea id="aiBulletInput" placeholder="Paste one resume bullet..." rows="3"></textarea>
        <button id="aiBulletBtn">âœ¨ Rewrite Bullet</button>
        <textarea id="aiBulletOutput" rows="3" readonly></textarea>
      </div>

      <!-- AI Section Improve -->
      <div class="ai-block">
        <h3 style="color:#facc15;">Improve Any Section</h3>
        <input id="aiSectionName" placeholder="Section name (Experience, Projects...)" />
        <textarea id="aiSectionInput" rows="4"></textarea>
        <button id="aiSectionBtn">âœ¨ Improve Section</button>
        <textarea id="aiSectionOutput" rows="4" readonly></textarea>
      </div>

      <!-- AI Keyword Optimization -->
      <div class="ai-block">
        <h3 style="color:#facc15;">Keyword Optimization</h3>
        <textarea id="aiKeywordInput" placeholder="Paste full resume text..." rows="5"></textarea>
        <button id="aiKeywordBtn">âœ¨ Analyze Keywords</button>
        <textarea id="aiKeywordOutput" rows="5" readonly></textarea>
      </div>

      <!-- AI Full ATS Improvement -->
      <div class="ai-block">
        <h3 style="color:#facc15;">Full ATS Resume Improvement</h3>
        <textarea id="aiFullInput" placeholder="Paste full resume text..." rows="6"></textarea>
        <button id="aiFullBtn">âœ¨ Full ATS Improve</button>
        <textarea id="aiFullOutput" rows="7" readonly></textarea>
      </div>
    </div>
  </div>

<script>
const API_BASE = "https://atspro-7pps.onrender.com";

function disableButton(btn, isLoading, text) {
  if (isLoading) {
    btn.disabled = true;
    btn.dataset.original = btn.textContent;
    btn.textContent = text || "â³ Processing...";
  } else {
    btn.disabled = false;
    btn.textContent = btn.dataset.original;
  }
}

// ------------------------
// FILE UPLOAD UI
// ------------------------
document.getElementById("fileTrigger").onclick = () => {
  document.getElementById("file").click();
};

document.getElementById("file").onchange = () => {
  const f = document.getElementById("file").files;
  document.getElementById("fileName").textContent = f.length ? f[0].name : "No file selected";
};

// ------------------------
// ATS CHECKER
// ------------------------
document.getElementById("resumeForm").addEventListener("submit", async (e) => {
  e.preventDefault();

  const file = document.getElementById("file").files[0];
  const jd = document.getElementById("job_description").value;
  const resultDiv = document.getElementById("result");
  const btn = document.getElementById("submitBtn");

  if (!file) return alert("Please upload a resume.");

  const form = new FormData();
  form.append("file", file);
  form.append("job_description", jd);

  disableButton(btn, true, "Analyzing resume...");

  resultDiv.style.display = "block";
  resultDiv.innerHTML = `<p style="color:#facc15;">Running ATS analysis...</p>`;

  try {
    const res = await fetch(`${API_BASE}/upload-resume`, {
      method: "POST",
      body: form
    });

    const data = await res.json();

    if (!res.ok) throw new Error(data.detail || "Server error");

    let html = `
      <h2 style="color:#facc15;">ATS Score: ${data.ats_score}/100</h2>
      <h3 style="color:#facc15;">Matched Keywords</h3>
      <p>${data.matched_keywords.join(", ") || "None"}</p>

      <h3 style="color:#facc15;">Formatting Issues</h3>
      <ul>${data.formatting_issues.map(i => `<li>${i}</li>`).join("")}</ul>

      <h3 style="color:#facc15;">Writing Issues</h3>
      <ul>${data.writing_issues.map(i => `<li>${i}</li>`).join("")}</ul>
    `;

    resultDiv.innerHTML = html;

  } catch (err) {
    resultDiv.innerHTML = `<p style="color:red;">Error: ${err.message}</p>`;
  }

  disableButton(btn, false);
});

// ------------------------
// AI SUMMARY
// ------------------------
document.getElementById("aiSummaryBtn").onclick = async () => {
  const input = document.getElementById("aiSummaryInput").value.trim();
  const output = document.getElementById("aiSummaryOutput");
  const jd = document.getElementById("job_description").value;
  const btn = document.getElementById("aiSummaryBtn");

  if (!input) return alert("Paste summary text first.");

  const fd = new FormData();
  fd.append("summary", input);
  fd.append("job_description", jd);

  disableButton(btn, true, "Thinking...");

  try {
    const res = await fetch(`${API_BASE}/ai/rewrite-summary`, { method: "POST", body: fd });
    const data = await res.json();
    output.value = data.improved_summary || "No AI response.";
  } catch (e) {
    output.value = "Error: " + e.message;
  }

  disableButton(btn, false);
};

// ------------------------
// AI BULLET
// ------------------------
document.getElementById("aiBulletBtn").onclick = async () => {
  const text = document.getElementById("aiBulletInput").value.trim();
  const jd = document.getElementById("job_description").value;
  const output = document.getElementById("aiBulletOutput");
  const btn = document.getElementById("aiBulletBtn");

  if (!text) return alert("Paste bullet text first.");

  const fd = new FormData();
  fd.append("bullet", text);
  fd.append("job_description", jd);

  disableButton(btn, true);

  try {
    const res = await fetch(`${API_BASE}/ai/rewrite-bullet`, { method: "POST", body: fd });
    const data = await res.json();
    output.value = data.improved_bullet || "No AI output.";
  } catch (err) {
    output.value = "Error: " + err.message;
  }

  disableButton(btn, false);
};

// ------------------------
// AI SECTION
// ------------------------
document.getElementById("aiSectionBtn").onclick = async () => {
  const name = document.getElementById("aiSectionName").value.trim();
  const text = document.getElementById("aiSectionInput").value.trim();
  const output = document.getElementById("aiSectionOutput");
  const btn = document.getElementById("aiSectionBtn");

  if (!text) return alert("Paste a section first.");

  const fd = new FormData();
  fd.append("section_name", name || "Section");
  fd.append("section_text", text);

  disableButton(btn, true);

  try {
    const res = await fetch(`${API_BASE}/ai/improve-section`, { method: "POST", body: fd });
    const data = await res.json();
    output.value = data.improved_section || "No AI response.";
  } catch (err) {
    output.value = "Error: " + err.message;
  }

  disableButton(btn, false);
};

// ------------------------
// AI KEYWORD
// ------------------------
document.getElementById("aiKeywordBtn").onclick = async () => {
  const resume = document.getElementById("aiKeywordInput").value.trim();
  const jd = document.getElementById("job_description").value;
  const output = document.getElementById("aiKeywordOutput");
  const btn = document.getElementById("aiKeywordBtn");

  if (!resume) return alert("Paste resume text.");
  if (!jd) return alert("Paste job description first.");

  const fd = new FormData();
  fd.append("resume_text", resume);
  fd.append("job_description", jd);

  disableButton(btn, true);

  try {
    const res = await fetch(`${API_BASE}/ai/keyword-optimize`, { method: "POST", body: fd });
    const data = await res.json();
    output.value = data.keyword_optimization || "No AI result.";
  } catch (err) {
    output.value = "Error: " + err.message;
  }

  disableButton(btn, false);
};

// ------------------------
// FULL ATS IMPROVE
// ------------------------
document.getElementById("aiFullBtn").onclick = async () => {
  const resume = document.getElementById("aiFullInput").value.trim();
  const jd = document.getElementById("job_description").value;
  const output = document.getElementById("aiFullOutput");
  const btn = document.getElementById("aiFullBtn");

  if (!resume) return alert("Paste full resume.");
  if (!jd) return alert("Paste job description.");

  const fd = new FormData();
  fd.append("resume_text", resume);
  fd.append("job_description", jd);

  disableButton(btn, true);

  try {
    const res = await fetch(`${API_BASE}/ai/full-ats-improve`, { method: "POST", body: fd });
    const data = await res.json();
    output.value = data.full_improvement || "No AI response.";
  } catch (err) {
    output.value = "Error: " + err.message;
  }

  disableButton(btn, false);
};
</script>

</body>
</html>
